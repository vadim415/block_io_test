# name: Testing

on:
  push:
    branches: [ "main" ]
#   pull_request:
#     branches: [ "main" ]

jobs:
  default:
    runs-on: self-hosted
  #validate-deploy:
  #  runs-on: ubuntu-22.04

    steps:
    # - name: Checkout repository
    #   uses: actions/checkout@v4
    # - name: Install Helm
    #   uses: azure/setup-helm@v4.3.0
    # - name: Install kubectl
    #   uses: azure/setup-kubectl@v4.0.1
    #   with:
    #     version: 'v1.33.1'

    - name: Dry-run apply Kubernetes manifests
      run: |
        echo "Validating ./deploy_manual_componenets"
        kubectl apply --dry-run=client -f deploy_manual_componenets/deploy.yaml

    - name: Validate ServiceMonitor prom-stack
      run: |
        echo "Validating deploy_manual_componenets/service_monitor_prom.yaml"
        kubectl apply --dry-run=client -f deploy_manual_componenets/service_monitor_prom.yaml

    - name:  Validate Kubernetes secrets/configs
      run: |
        echo " Validating secrets/configs..."
        if [ -f ./k8s/secrets.yaml ]; then
          kubectl apply --dry-run=client -f ./k8s/secrets.yaml
        else
          echo "No secrets.yaml found â€” skipping..."
        fi

    - name: Done
      run: echo "ok"

